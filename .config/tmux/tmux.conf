# true color
# set -g default-terminal "xterm-256color"
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"
set-option -sa terminal-overrides ",$TERM:Tc"
set -as terminal-features 'xterm*:extkeys'

set -g default-terminal "''${TERM}"
set -g default-terminal "tmux-256color"

# set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
# set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0
# set -as terminal-overrides ',xterm-256color:Tc'

# set -g default-terminal "screen-256color"
# set -ag terminal-overrides ",screen-256color:RGB"

setw -g mode-keys vi

set -g history-limit 10000

set -g base-index 1
setw -g pane-base-index 1
set-window-option -g pane-base-index 1

set -g allow-rename on

set -g renumber-windows on

# A bell in another window should cause a bell in the current window
set -g bell-action any

# Don't show distracting notifications
set -g visual-bell off
set -g visual-activity off

set -g @continuum-restore 'on'

# prefix
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Focus events enabled for terminals that support them
set -g focus-events on

# Useful when using sharing a session with different size terminals
setw -g aggressive-resize on

# don't detach tmux when killing a session
set -g detach-on-destroy off

# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0
set -s extended-keys on

# %if #{TMUX}
	set-option -g status-left-length 20
    set-option -g status-justify centre
	set-option -g status-left " #{session_name} "
	set-option -g status-style "fg=#7C7D83 bg=default"
    set-option -g status-right " #(whoami) " #  %H:%M "

	set-option -g window-status-format "#{window_index}:#{window_name}#{window_flags} " # window_name -> pane_current_command
	set-option -g window-status-current-format "#{window_index}:#{window_name}#{window_flags} "
	set-option -g window-status-current-style "fg=#dcc7a0"
	set-option -g window-status-activity-style none
    # set -g status-right "#{prefix_highlight}#[fg=cyan,bg=black,nobold,noitalics,nounderscore]#[fg=black,bg=cyan,bold] #H "
# %endif

set -g set-titles on

# mouse
setw -g mouse on

bind-key -r 'C-f' run-shell "tmux neww ~/scripts/tmux-sessionizer"

# splitting windows and panes
bind-key v split-window -h -c "#{pane_current_path}"
bind-key h split-window -v -c "#{pane_current_path}"
bind-key c neww -c "#{pane_current_path}"

bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

bind-key -r 'C-h' select-pane -L
bind-key -r 'C-j' select-pane -D
bind-key -r 'C-k' select-pane -U
bind-key -r 'C-l' select-pane -R
bind-key -r 'l' select-pane -l

# reloading config
bind-key r source-file ~/.config/tmux/tmux.conf \; display-message "tmux.conf reloaded"

bind b switch-client -l

bind \\ run "tmux select-layout tiled > /dev/null"
bind S command-prompt -p "New Session:" "new-session -A -s '%%'"
bind M confirm kill-session

# bind-key -r 'i' run-shell "tmux neww cht.sh"
bind-key -r i neww cht.sh

set-option -g status-position bottom

# plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

run '~/.tmux/plugins/tpm/tpm'

# Custom statusline borrowed from Takuya https://github.com/craftzdog/dotfiles-public

# set -g mode-style "fg=#eee8d5,bg=#073642"
#
# set -g message-style "fg=#eee8d5,bg=#073642"
# set -g message-command-style "fg=#eee8d5,bg=#073642"
#
# set -g pane-border-style "fg=#073642"
# set -g pane-active-border-style "fg=#eee8d5"
#
# set -g status "on"
# set -g status-interval 1
# set -g status-justify "left"
#
# set -g status-style "fg=#586e75,bg=#073642"
#
# set -g status-bg "#002b36"
#
# set -g status-left-length "100"
# set -g status-right-length "100"
#
# set -g status-left-style NONE
# set -g status-right-style NONE
#
# # set -g status-left "#[fg=#073642,bg=#eee8d5,bold] #S #[fg=#eee8d5,bg=#93a1a1,nobold,nounderscore,noitalics]#[fg=#15161E,bg=#93a1a1,bold] #(whoami) #[fg=#93a1a1,bg=#002b36]"
#
# set -g status-left "#[fg=#073642,bg=#b5af9b,bold] #S #[fg=#eee8d5,bg=#586e75,nobold,nounderscore,noitalics]#[fg=#15161E,bg=#586e75,bold] #(whoami) #[fg=#586e75,bg=#002b36]"
#
# set -g status-right "#[fg=#586e75,bg=#002b36,nobold,nounderscore,noitalics]#[fg=#93a1a1,bg=#586e75]#[fg=#657b83,bg=#586e75,nobold,nounderscore,noitalics]#[fg=#93a1a1,bg=#657b83]#[fg=#93a1a1,bg=#657b83,nobold,nounderscore,noitalics]#[fg=#15161E,bg=#93a1a1,bold] #h  %H:%M"
#
# setw -g window-status-activity-style "underscore,fg=#839496,bg=#002b36"
# setw -g window-status-separator ""
# setw -g window-status-style "NONE,fg=#839496,bg=#002b36"
# setw -g window-status-format '#[fg=#002b36,bg=#002b36]#[default] #I  #{b:pane_current_path} #[fg=#002b36,bg=#002b36,nobold,nounderscore,noitalics]'
# setw -g window-status-current-format '#[fg=#002b36,bg=#eee8d5]#[fg=#268bd3,bg=#eee8d5,bold,italics] #I #[fg=#eee8d5,bg=#b58900] #{b:pane_current_path} #[fg=#b58900,bg=#002b36]'

